tinymce.PluginManager.add('custom_plug', function (editor, url) {

	//***** create a tooltip on selection 

		// load css 
		editor.on('init', function() {
			editor.dom.loadCSS(url + '/plugin.css');
		});

		// get content of selection
		editor.addCommand('tooltip_create', function () {
			var content = tinymce.activeEditor.selection.getContent(); 

			// create pop up and set selection to what is in popup 
			tinymce.activeEditor.windowManager.open({
					title: 'Example plugin',
					body: [
					 {type: 'textbox', name: 'visibletext', label: 'Visible Text', value: content}, 
					  {type: 'textbox', name: 'hiddentext', label: 'Hidden Text'}
					],
					onsubmit: function(e) {
					 tinymce.activeEditor.selection.setContent('<span class="tooltipzota">'+ e.data.visibletext +'<span class="tooltiptextzota">' + e.data.hiddentext + '</span></span>');
					}
				  }); // end of tinymce.activeEditor.windowManager.open
		}); // end of editor.addCommand



	//***** change fontsize from 14px to 10px to 18px
	// from https://stackoverflow.com/questions/25420036/how-can-i-increment-and-decrement-the-fontsize-via-shortcut-tinymce/25522247
		editor.addCommand('customfontsize_command', function () {
			var content = tinymce.activeEditor.selection.getContent();
			var node = tinymce.activeEditor.selection.getNode();
			var fontsize = tinymce.activeEditor.dom.getStyle(node, 'font-size', true);

			fontsize = fontsize.split("p", 1)
			fontsize--;

			if (fontsize >10  && fontsize <=14) {
					fontsize = 10;
			}
			else if (fontsize <=10){
					fontsize = 18;
			}
			else{
					fontsize = 14;
			}
				fontsize = fontsize + "px";
				tinymce.activeEditor.execCommand('fontsize', false, fontsize);
		});// end customfontsize_command


	//***** font color 
		// color is retrieved by getStyle are rgb but need to be sent to command ForeColor are hex  

		//red
		editor.addCommand('customfontcolor_red', function () {
			var content = tinymce.activeEditor.selection.getContent();
			var node = tinymce.activeEditor.selection.getNode();
			var color = tinymce.activeEditor.dom.getStyle(node, 'color', true);
			if (color =="rgb(215, 0, 0)") {
					newcolor = "#000000";
			}
			else{
					newcolor ="#FF0000";
			}
				tinymce.activeEditor.execCommand('ForeColor', false, newcolor);
		});  // end customfontcolor_red
	 
		//marron 
		editor.addCommand('customfontcolor_marron', function () {
			var content = tinymce.activeEditor.selection.getContent();
			var node = tinymce.activeEditor.selection.getNode();
			var color = tinymce.activeEditor.dom.getStyle(node, 'color', true);
			if (color =="rgb(153, 51, 0)") {
					newcolor = "#000000";
			}
			else{
					newcolor ="#993300";
			}
				tinymce.activeEditor.execCommand('ForeColor', false, newcolor);
		});  // end customfontcolor_marron

		//blue	
		editor.addCommand('customfontcolor_blue', function () {
			var content = tinymce.activeEditor.selection.getContent();
			var node = tinymce.activeEditor.selection.getNode();
			var color = tinymce.activeEditor.dom.getStyle(node, 'color', true);
			if (color =="rgb(51, 102, 255)") {
					newcolor = "#000000";
			}
			else{
					newcolor ="#3366FF";
			}
				tinymce.activeEditor.execCommand('ForeColor', false, newcolor);
		});  // end customfontcolor_blue 
 

	//***** back color 
		// color is retrieved by getStyle are rgb but need to be sent to command ForeColor are hex 

		// yellow pale
		editor.addCommand('custombackcolor_yellowpale', function () {
			var content = tinymce.activeEditor.selection.getContent();
			var node = tinymce.activeEditor.selection.getNode();
			var color = tinymce.activeEditor.dom.getStyle(node, 'background-color', true);
			if (color =="rgb(255, 255, 153)") {
					newcolor = "transparent";
			}
			else{
					newcolor ="#FFFF99";
			}
				tinymce.activeEditor.execCommand('HiliteColor', false, newcolor);
		});  // end custombackcolor_yellowpale 

		// yellow fonce
		editor.addCommand('custombackcolor_yellowfonce', function () {
			var content = tinymce.activeEditor.selection.getContent();
			var node = tinymce.activeEditor.selection.getNode();
			var color = tinymce.activeEditor.dom.getStyle(node, 'background-color', true);
			if (color =="rgb(255, 255, 0)") {
					newcolor = "transparent";
			}
			else{
					newcolor ="#FFFF00";
			}
				tinymce.activeEditor.execCommand('HiliteColor', false, newcolor);
		});  // end custombackcolor_yellowfonce  

		// orange	
		editor.addCommand('custombackcolor_orange', function () {
			var content = tinymce.activeEditor.selection.getContent();
			var node = tinymce.activeEditor.selection.getNode();
			var color = tinymce.activeEditor.dom.getStyle(node, 'background-color', true);
			if (color =="rgb(255, 204, 0)") {
					newcolor = "transparent";
			}
			else{
					newcolor ="#FFCC00";
			}
				tinymce.activeEditor.execCommand('HiliteColor', false, newcolor);
		});  // end custombackcolor_orange  
		 
		// pink
		editor.addCommand('custombackcolor_pink', function () {
			var content = tinymce.activeEditor.selection.getContent();
			var node = tinymce.activeEditor.selection.getNode();
			var color = tinymce.activeEditor.dom.getStyle(node, 'background-color', true);
			if (color =="rgb(255, 153, 204)") {
					newcolor = "transparent";
			}
			else{
					newcolor ="#FF99CC";
			}
				tinymce.activeEditor.execCommand('HiliteColor', false, newcolor);
		});  // end custombackcolor_pink
		 

 
	//*** add shorcut 
		// for js key cf cf http://keycode.info/   32 = space  // 110 = point from numpad
		// "meta" = Ctrl on PC
		editor.addShortcut('ctrl+t', 'indent_desc', 'indent'),  
		editor.addShortcut('ctrl+shift+32', 'outdent_desc', 'outdent'),  
		editor.addShortcut('ctrl+110', 'upper script', 'superscript'), 
		editor.addShortcut('ctrl+32', 'remove formatter', 'RemoveFormat'),
		editor.addShortcut('ctrl+shift+s', 'code_desc', 'mceCodeEditor'),
		editor.addShortcut('alt+s', 'striketrhougg', 'Strikethrough'),
		editor.addShortcut('alt+q', 'customfontsize_desc', 'customfontsize_command'),
		editor.addShortcut('alt+r', 'customfontcolor_red', 'customfontcolor_red'),
		editor.addShortcut('alt+w', 'customfontcolor_marron', 'customfontcolor_marron'),
		editor.addShortcut('alt+y', 'custombackcolor_yellowpale', 'custombackcolor_yellowpale'),
		editor.addShortcut('alt+shift+y', 'custombackcolor_yellowfonce', 'custombackcolor_yellowfonce'),
		editor.addShortcut('alt+o', 'custombackcolor_orange', 'custombackcolor_orange'), 
		editor.addShortcut('alt+p', 'custombackcolor_pink', 'custombackcolor_pink'); 
		editor.addShortcut('ctrl+alt+t', 'tooltip_create_desc', 'tooltip_create');  
 
});  // end   tinymce.PluginManager.add


